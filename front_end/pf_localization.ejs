<%- include('./partial_imports/import_above_content.ejs', { Title: "Localization with Particle Filter", PageAddr: 'pf_localization' } ) %>


<!-- INLINE FORM ELELEMNTS -->
<!-- <div class="row mt">
    <div class="col-lg-12">
        <div class="form-panel">
        <h4 class="mb"><i class="fa fa-angle-right"></i> Kalman Parameters</h4>

        <div class="row mt">
            <div class="col-lg-8">
                <div class="form-inline" role="form" class="col-sm-6">
                    <div class="form-group">
                        <input class="form-control" id="init_x" placeholder="Initial x Value">
                    </div>
                    <div class="form-group">
                        <input class="form-control" id="init_y" placeholder="Initial y Value">
                    </div>
                    <button class="btn btn-theme" id="btnInitial">Add Initial x & y with Mouse Click</button>
                </div>
            </div>
        </div>
        <div class="row mt">
            <div class="col-lg-8">
                <form class="form-inline" role="form" class="col-sm-6">
                    <div class="form-group">
                        <input class="form-control" id="std_x" placeholder="Std in x-direction">
                    </div>
                    <div class="form-group">
                        <input class="form-control" id="std_y" placeholder="Std in y-direction">
                    </div>
                </form>
            </div>
        </div>
        <div class="row mt">
            <div class="col-lg-8">
                <form class="form-inline" role="form">
                    <div class="form-group">
                        <input class="form-control" id="dt" placeholder="dt">
                    </div>
                    <div class="form-group">
                        <input class="form-control" id="process_noise" placeholder="Process Noise Magnitude">
                    </div>
                </form>
            </div>
        </div>


        <div class="row mt">
            <div class="form-group form-horizontal">
                <label class="col-sm-2 control-label"  style="padding-left: 20px; width: 16%;">Connection Type</label>
                <div class="col-sm-4" style="padding-left: 0px;">
                    <select class="form-control" id="connection_type" style="padding-left: 0px;">
                        <option value="uart">UART</option>
                        <option value="tcp">TCP/IP</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="row mt">
            <div class="form-group form-horizontal">
                <label class="col-sm-2 control-label"  style="padding-left: 20px; width: 16%;">UART</label>
                <div class="col-sm-4" style="padding-left: 0px;">
                    <select class="form-control" id="uart_select" style="padding-left: 0px;">
                    </select>
                </div>
                <button type="button" class="btn btn-primary" id="reloadUart">Reload</button>
            </div>
        </div>
        </div>
    </div>
</div> -->

<div style="margin: 5px;">
    <button type="button" class="btn btn-primary" id="btnRun" >Run</button>
    <button type="button" class="btn btn-primary" id="btnStop" >Stop</button>
    <button type="button" class="btn btn-primary" id="btnReset" >Reset</button>

</div>

<canvas class="webgl" id="threejs_canvas"> 
</canvas>

<br /> <br />

<main>
</main>

<%- include('./partial_imports/import_below_content.ejs') %>


<script type="text/javascript">

    $(document).ready( () => {
    
        $("#btnStartCar").click( () => {
    
            renderHelper.shouldMoveCar = !renderHelper.shouldMoveCar;
        });
    
        $("#btnReset").click( () => {
    
            renderHelper.resetCarPosition();
        });
    
    } );
    
    
    const THREE = require('three');
    
    require('../ekf_localization/GLTFLoader');
    require('../ekf_localization/OrbitControls');
    require('../ekf_localization/RoomEnvironment');
    
    const Ammo = require('../ekf_localization/ammo');
    require('../ekf_localization/Detector');
    require('../ekf_localization/stats.min');

    const { RenderHelper } = require('../classes/cls_pf_localization');
    
    // const windowWidth = 900;
    // const windowHeight = 600;
    
    const scene = new THREE.Scene();
    const axesHelper = new THREE.AxesHelper( 200 );
    const loader = new THREE.GLTFLoader();
    const canvas = document.querySelector("canvas.webgl");
    const textureLoader = new THREE.TextureLoader();
    
    var time = 0;
    var dt = 0;
    let renderHelper = new RenderHelper( scene, canvas );

    // renderHelper.initPhysicsGraphics();
    // renderHelper.initPhysics();
    renderHelper.addBoxes();
    renderHelper.render();


    // var animate = function () {

    //     requestAnimationFrame(animate);

    //     // renderHelper.moveCar();
    //     // renderHelper.render();
            
    //     time += dt;
    // };

    // animate();


    
    </script>
    